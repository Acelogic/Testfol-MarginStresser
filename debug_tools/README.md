# Debug Tools Reference

This directory contains debugging and testing utilities for the Testfol MarginStresser project. Below is a table of contents describing each file's purpose.

## Files

| File | Purpose | Category |
|------|---------|----------|
| **API Debugging** | | |
| `inspect_api_response.py` | Fetches backtest data from the API and dumps the raw JSON response to `api_dump.json` for inspection | API |
| `api_dump.json` | JSON dump of API responses (generated by `inspect_api_response.py`) | Data |
| `verify_dump.py` | Verifies the contents of `api_dump.json`, checking for specific keys like "assets" | API |
| `inspect_raw.py` | Comprehensive inspection of raw API responses with a complex portfolio allocation, examining keys like "assets" and "charts" | API |
| `inspect_rebal.py` | Inspects rebalancing events and statistics from the dumped API response | API |
| `trace_2022.py` | Detailed trace of rebalancing events for year 2022, calculating cost basis, trades, and P&L for debugging rebalancing logic | API |
| **Excel Data Inspection** | | |
| `list_sheets.py` | Lists all sheet names in the Federal Capital Gains Tax Excel file | Excel |
| `find_header.py` | Reads first 20 rows of Sheet1 without header to locate where actual data begins | Excel |
| `inspect_sheet1.py` | Inspects first 10 rows of Sheet1 to find header row location | Excel |
| `inspect_excel.py` | Displays all sheet names and previews first 10 rows of each sheet in the tax rates Excel file | Excel |
| `inspect_excel_headers.py` | Inspects first 10 rows of "Historical Capital Gains Rates" sheet to locate header | Excel |
| `verify_headers.py` | Verifies correct header row (row 7) in Sheet1 and displays column names | Excel |
| `verify_excel_data.py` | Verifies specific years (1913, 1980, 2000, 2024, 2025) exist in the Excel data with correct rates | Excel |
| **Tax Calculation Testing** | | |
| `test_2000s_tax.py` | Tests historical capital gains tax calculations for the 2000s era (2000, 2005, 2010), verifying inclusion rates and alternative max rates | Tax |
| `repro_loss_carryforward.py` | Reproduces and tests loss carryforward functionality with mock data (Year 1 loss, Year 2 gain) | Tax |
| **Logs** | | |
| `shadow_backtest.log` | Log file from shadow backtest runs | Logs |

## Quick Reference

### Running API Tests
```bash
# Fetch and dump API response
python debug_tools/inspect_api_response.py

# Verify the dump
python debug_tools/verify_dump.py

# Inspect rebalancing data
python debug_tools/inspect_rebal.py

# Trace specific year (2022)
python debug_tools/trace_2022.py
```

### Inspecting Excel Data
```bash
# List all sheets
python debug_tools/list_sheets.py

# Find header location
python debug_tools/find_header.py

# Verify data integrity
python debug_tools/verify_excel_data.py
```

### Testing Tax Calculations
```bash
# Test 2000s era calculations
python debug_tools/test_2000s_tax.py

# Test loss carryforward
python debug_tools/repro_loss_carryforward.py
```

## Notes

- Most Excel inspection scripts reference `../Federal-Capital-Gains-Tax-Rates-Collections-1913-2025_fv.xlsx`
- API debugging scripts use `testfol_api` module from the parent directory
- Tax testing scripts import from `tax_library.py` in the parent directory
- All scripts are designed to be run from the project root or debug_tools directory
